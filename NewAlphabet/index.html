<!doctype html>
<html lang="ru" xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>í - Novyj russkij alfavit</title>
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="static/style/fonts.css">
    <link rel="stylesheet" href="static/style/style.css">
</head>
<body>
<header>
    <h1>í</h1>
    <div>
        <a href="index.html">
            <div class="header-button">
                <p>Перевести</p>
            </div>
        </a>
        <a href="alphabet.html">
            <div class="header-button">
                <p>Алфавит</p>
            </div>
        </a>
    </div>
</header>
<main>
    <h2>Введите Ваш текст:</h2>
    <div class="enter-text">
        <label for="inputText"></label>
        <textarea id="inputText" rows="1"></textarea>
        <button onclick="replaceText()"><img src="static/images/free-icon-enter-10233890.png" alt="Отправить"></button>
    </div>
    <div class="result">
        <div id="resultText"></div>
<!--        <button class="copy-button" onclick="copyResult()">Скопировать</button>-->
    </div>
    <script>

        let copyButtonAdded = false; // Флаг для отслеживания, была ли кнопка "Скопировать" уже добавлена

        function replaceCharacters(text) {
            // Словарь замен для русского алфавита с учетом регистра
            const replacementDict = {
                'а': 'a',
                'б': 'b',
                'в': 'v',
                'г': 'g',
                'д': 'd',
                'е': 'e',
                'ё': 'ö',
                'ж': 'ž',
                'з': 'z',
                'и': 'i',
                'й': 'j',
                'к': 'k',
                'л': 'l',
                'м': 'm',
                'н': 'n',
                'о': 'o',
                'п': 'p',
                'р': 'r',
                'с': 's',
                'т': 't',
                'у': 'u',
                'ф': 'f',
                'х': 'h',
                'ц': 'c',
                'ч': 'x',
                'ш': 'š',
                'щ': 'ś',
                'ы': 'y',
                'ь': 'í',
                'э': 'e',
                'ю': 'ü',
                'я': 'ä',
                'А': 'A',
                'Б': 'B',
                'В': 'V',
                'Г': 'G',
                'Д': 'D',
                'Е': 'E',
                'Ё': 'Ö',
                'Ж': 'Ž',
                'З': 'Z',
                'И': 'I',
                'Й': 'J',
                'К': 'K',
                'Л': 'L',
                'М': 'M',
                'Н': 'N',
                'О': 'O',
                'П': 'P',
                'Р': 'R',
                'С': 'S',
                'Т': 'T',
                'У': 'U',
                'Ф': 'F',
                'Х': 'X',
                'Ц': 'C',
                'Ч': 'X',
                'Ш': 'Š',
                'Щ': 'Ś',
                'Ы': 'Y',
                'Ь': 'Í',
                'Э': 'E',
                'Ю': 'Ü',
                'Я': 'Ä',
                'Ъё': 'Jo',
                'Ъю': 'Ju',
                'Ъе': 'Je',
                'Ъя': 'Ja',
                'ъя': 'ja',
                'ъё': 'jo',
                'ъю': 'ju',
                'ъе': 'je'
            };

        // Замена символов в тексте с учетом регистра
        let replacedText = '';
        let i = 0;
        while (i < text.length) {
            const char = text[i];
            if (i + 2 < text.length && text.slice(i, i + 2) in replacementDict) {
                const replacement = replacementDict[text.slice(i, i + 2)];
                i += 2;
                replacedText += replacement;
            } else {
                const replacement = replacementDict[char] || char;
                i += 1;
                replacedText += char === char.toUpperCase() ? replacement.toUpperCase() : replacement;
            }
        }

            return replacedText;

        }

        function resizeTextarea() {
            const textarea = document.getElementById("inputText");
            textarea.style.height = "auto"; // Сбрасываем высоту до автоматической
            textarea.style.height = textarea.scrollHeight + "px"; // Устанавливаем высоту равной высоте содержимого
        }

        function replaceText() {
            const user_input = document.getElementById("inputText").value;
            const result = replaceCharacters(user_input);

            const resultDiv = document.getElementById("resultText");
            resultDiv.innerHTML = "<h2>Результат замены:</h2><p>" + result + "</p>";

        // Вызываем функцию для автоматического изменения высоты textarea
            resizeTextarea();

            if (!copyButtonAdded) {
                // Добавляем кнопку "Скопировать" только если она ещё не добавлена
                const copyButton = document.createElement("button");
                copyButton.innerText = "Скопировать";
                copyButton.className = "copy-button";
                copyButton.onclick = copyResult;
                resultDiv.appendChild(copyButton);
                copyButtonAdded = true;
            }
        }

        function copyResult() {
            const resultText = document.getElementById("resultText").getElementsByTagName("p")[0];
            const range = document.createRange();
            range.selectNode(resultText);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);

            try {
                // Копируем выделенный текст в буфер обмена
                document.execCommand('copy');
                alert('Текст успешно скопирован!');
            } catch (err) {
                console.error('Не удалось скопировать текст: ', err);
            }

            selection.removeAllRanges();
        }

        // Обрабатываем событие ввода, чтобы textarea автоматически ресайзился при изменении содержимого
        const textarea = document.getElementById("inputText");
        textarea.addEventListener("input", function() {
            resizeTextarea();
            copyButtonAdded = false; // Сбрасываем флаг при новом вводе текста
        });
    </script>
</main>
</body>
</html>